#!/bin/bash
# TDD Pre-commit hook for WhatsApp Clone

set -e

echo "ğŸ” Running TDD pre-commit checks..."

# 1. Analyze code
echo "ğŸ“Š Running flutter analyze..."
if ! flutter analyze --no-congratulate; then
    echo "âŒ Flutter analyze failed. Fix errors before committing."
    exit 1
fi

# 2. Run tests
echo "ğŸ§ª Running tests..."
if ! flutter test; then
    echo "âŒ Tests failed. All tests must pass before committing."
    exit 1
fi

# 3. Check test coverage
echo "ğŸ“ˆ Checking test coverage..."
flutter test --coverage
if [ -f coverage/lcov.info ]; then
    # Parse coverage percentage (basic check)
    echo "âœ… Coverage report generated"
else
    echo "âš ï¸  Coverage report not generated"
fi

echo "âœ… All TDD checks passed! Ready to commit."